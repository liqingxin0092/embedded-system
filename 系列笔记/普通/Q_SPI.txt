只有部分,不全,还有些在纸质笔记上.

内存映射模式: (1).用于读取操作.
(2).使用外部QSPI内存最为内部存储器,其他主机可以自主读取数据.
(3).用于从QSPI内存执行代码.XIP

在内存映射模式下,用于从QSPI内存接口能够管理从0x9000 0000~0x9fff ffff.最多256MByte内存.

操作指针方式.

命令序列(间接模式 或者 内存映射模式)

时序由以下组成:指令,地址,交替字节,空周期及数据五个部分组成.

一般情况下,进行数据读写包括:指令,地址和数据阶段.
5个阶段支持的配置:是否启动,长度,传输数据线(每个阶段要几根线).

(1).指令阶段:主机向FLASH发送操作指令(8位).

QSPI寄存器__CCR[7:0],要发什么把就写到这里面.

发送指令通常设置数据线为一根.根数取决于CCR[9:8].

(2).地址阶段:

间接模式和自动轮询模式下,等待发送地址字节数据在寄存器中._AR寄存器.

主机向FLASH发送地址长度(1~4字节) _CCR[13:12],ADSIZE长度.

设置传输的线数量,决定一次发几位数据,_CCR[11:10]决定.


(3).交替字节阶段:控制操作方式,连续发送备用字节,以保持设备处于工作模式.(内存制造商要求的).

发送的交替字节数_CCR[17:16] ABSIZE位决定.
发送的内容由ABR[31:0]决定.
也可以选择数据线根数.
一般情况下用不到.

(4).空指令周期.

设置1~31个周期内不发送/接收数据,给FLASH留准备数据阶段时间.

CCR的[22:18].

高速场景中,空指令延时确保数据信号从输出模式变为输入模式.

(5).数据阶段.

在间接模式和自动轮询模式下,从FLASH接收或发送任意数量的字节.
DLR里设置字节长度,DR里读取数据.配置数据线根数,是否启动也能配置.

还要设置QSPI对象信息.

容量大小.dcr寄存器里的fsize.  fsize+1是指对flash寻址所需的地址位数.在间接模式下,FLASH容量最高可达4GB(32位寻址),但在内存映射模式下的可寻址空间限制为256MB. 比如Q128的fsize写23,Q256的fsize写24.

时钟模式:片选拉高时,CLK时钟极性.就跟标准SPI一样.

DCR中CKMODE=0,CLK在CS高电平期间保持低电平,为模式0.
DCR中CKMODE=1,CLK在CS高电平期间保持高电平,为模式3.

设置[片选拉低]到[发送命令]的时间.

QSPI中断:超时,状态匹配(状态轮询模式才有),FIFO达到阈值(间接模式),传输完成(间接模式下DLR设定的字节数已经发送完成),传输错误(间接模式下地址越界)

配置时钟一定要看W25Q128支持133MHz,H750在QSPI配置时钟那也设置成1也就是2分频.

一定要注意引脚重映射!!!!!!
卧槽,逆天cubemax不会自己改引脚速度.